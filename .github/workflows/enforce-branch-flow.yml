name: Enforce Branch Flow
on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-merge-path:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Merge Path
        run: |
          BASE=${{ github.base_ref }}
          HEAD=${{ github.head_ref }}

          echo "üß© Checking PR from $HEAD ‚Üí $BASE"

          if [[ "$BASE" == "test" && "$HEAD" != "dev" ]]; then
            echo "‚ùå Only merges from dev ‚Üí test are allowed!"
            exit 1
          fi

          if [[ "$BASE" == "cicd" && "$HEAD" != "test" ]]; then
            echo "‚ùå Only merges from test ‚Üí cicd are allowed!"
            exit 1
          fi

          if [[ "$BASE" == "pre-prod" && "$HEAD" != "cicd" ]]; then
            echo "‚ùå Only merges from cicd ‚Üí pre-prod are allowed!"
            exit 1
          fi

          if [[ "$BASE" == "main" && "$HEAD" != "pre-prod" ]]; then
            echo "‚ùå Only merges from pre-prod ‚Üí main are allowed!"
            exit 1
          fi

          echo "‚úÖ Merge path is valid."
